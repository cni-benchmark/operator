version: "3"

set: [pipefail]

tasks:
  default:
    cmds:
      - task: test

  unit-tests:
    desc: Run Go tests
    cmds:
      - go test ./... -v -ginkgo.v

  e2e-tests:
    desc: Deploy test cases to KIND cluster
    cmds:
      - CGO_ENABLED=0 go build --ldflags='-s -w' -a -o dist/cni-benchmark-operator cmd/main.go
      - docker build -t operator:latest .
      - task: kind:create
      - task: kind:load
        vars:
          image: operator:latest

  clean:
    desc: Clean everything
    cmds:
      - task: kind:clean

includes:
  kind:
    taskfile: ./kind/taskfile.yaml
    dir: ./kind
